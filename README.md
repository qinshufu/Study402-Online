# Study402-Online

## 项目简介

一个在线教育项目的实现，采用微服务架构，同时没有太多的业务规则，浏览一下代码会发现，输入都没有做验证，
业务逻辑也不完整。这是因为一个完整的在线教育项目的微服务架构实现不是我编写该项目的目标.

该项目的目的对微服务相关技术架构进行一个展示，目标适用的相关技术架构为：

1. 架构模式适用微服务以及 CQRS，但并没有适用领域驱动设计
2. 适用 Redis 以及 RabbitMQ
3. ...

还有一个比较严重的问题就是没有测试...所以只能看看代码，但是正确运行确实不一定的😀

### 项目结构
BuildingBlocks 为公用的构建块

Gateways 保存网关

Service 下为微服务项目

## 一些解释

### 数据验证验证

#### 输入验证

首先，该项目的 Web API 没有对输入的请求进行验证，这是一个很严重的问题，在实际的公司项目中不要学习这里不做验证而必须应该进行验证。

关于输入数据的验证主要有两个方面：

1. 一个是数据格式上面的与业务逻辑无关的
2. 另外一个是与业务逻辑相关的，比如验证操作的课程是否存在等

关于这两类验证应该放在那里是一个值得讨论的问题，它们是应该放在一起还是应该拆分在不同的位置呢？个人看法是这两类验证应该拆分。

#### 业务逻辑的验证

是的，关于业务逻辑也没有怎么做验证（那要写很多代码，我一个人写不完同时也是一件无聊的事情）

### 数据库配置

#### 数据库的约束

是的，需要创建数据库表的约束，我也没有做，直接默认（因为这是一件无聊的事情）

#### 数据库的部分字段

其中有些字段设置起来，我直接使用的默认值，在业务逻辑中实际上是需要根据上下问来获取的

### 关于错误的状态码

也许需要根据业务提供错误状态吗，这个也没有做

### 完整的业务逻辑

这个更不用说了，我一个人写不完，所以随便插插数据得了😂

## 对外部依赖进行隔离

这个也没有做，例如文件存储直接使用的 Aliyun SDK 的 OssClient 类，实际上最好用 IStorage 接口包装

简而言之，该项目仅仅是作为 项目架构的 .NET 微服务实验以及编码格式的一个展示

## 关于消息可靠性的解决

个人直接使用的 MassTransit 这个消息总线，但是我好像并没有找到这个消息总线关于消息可靠性是如何解决的。

如果使用 RabbitMQ 的话，个人会使用服务端确认以及消息持久化来保证消息投递的可靠性，但是这个需要自己手动编写，
然而我期待能够有现成的解决方案，因为我知道个人造的轮子水平质量都堪忧。

## 关于有些同样的问题，不同的解决方案

譬如调用 HTTP API 接口的时候，有时候可以看到我使用的是 HttpClient 手动编码调用，还有的使用使用的是 Refit（声明式 HTTP 客户端）
的解决方案。有部分项目将 VO 和 POCO 放到了一个新的项目中，还有的项目将其放在 Api 项目中。

这是因为我的想法不断在变化😀，一开始是直接 HttpClient 手动调用，但是后来我发现这样重复代码太多（因为一开始我以为不会写很多调用代码），
后面我尝试了关于 Http 客户端的两种不同解决方案：

1. AutoRest 代码生成方案
2. Refit 之类的声明式 HTTP 客户端

最后选择 Refit 的原因是，我配置了一下 AutoRest 发现生成的代码不太和我心意，查了一下资料还是不知道该怎么解决

## 开发环境

VS2022/Rider + .NET7 + windows10 + Docker Desktop

## TODO

- [ ] 设置 CreateTime 字段为数据库提供默认值，Creater Updater 等字段没有设置...
- [ ] 为模型字段配置合适的数据库类型，例如存储大文本的字段使用 text 类型
- [ ] 将业务逻辑填充完整
- [ ] 编写前端
- [ ] 配置网关
- [ ] 编写 docker file，配置 docker
- [ ] 配置 ci/cd
- [ ] 使用 HangFire 替换自定义的视频转码控制台项目
- [ ] 测试
- [x] 使用 MassTrasit 或者 NServiceBus 做消息总线

总的来说，将其变成一个真实的企业级项目，但是这个工作量看起来太大了，我不想做...

